<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>首页</title>


	{include file="common/header" /}

	<style>
		ul,li{
			list-style: none;
			margin: 0;
			padding: 0;
		}
		.control{
			visibility: hidden;
		}
	</style>
	</head>
<body>
<header>
	<div class="h3 col-lg-12 bg-info">Leoc——记事共享</div>
	<h4>{$check}</h4>
	<button onclick="Control()">编辑</button>

</header>
<content>
<div class="col-lg-8 col-lg-offset-2">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#my_records" aria-controls="home" role="tab" data-toggle="tab">我的说说</a></li>
    <li role="presentation"><a href="#add_record" aria-controls="add_record" role="tab" data-toggle="tab">添加说说</a></li>
    <li role="presentation"><a href="#friends_records" aria-controls="friends_records" role="tab" data-toggle="tab">好友说说</a></li>
    <li role="presentation"><a href="#friends_list" aria-controls="friends_list" role="tab" data-toggle="tab">好友列表</a></li>
    <li role="presentation"><a href="#add_friend" aria-controls="add_friend" role="tab" data-toggle="tab">添加好友</a></li>
    <li role="presentation"><a href="#logout" aria-controls="logout" role="tab" data-toggle="tab">注销登录</a></li>
  </ul>
 <!-- Tab panes -->
	<div class="tab-content">
	  <div role="tabpanel" class="tab-pane fade in active" id="my_records">
	  	<br>
	  	<br>

		<ul>
			{volist name='recordList' id='record_item'}
			<li>
			<div class="panel panel-default">
			  <div class="panel-heading">
			  <span class="h3">{$record_item.author}</span>
			  <div class="control pull-right">
				    <a class="btn btn-danger" href="{$Think.config.INDEX}/user_r_delete?user_id={$record_item.user_id}&id={$record_item.id}" >删除</a>
					<button type="button" class="btn btn-warning" onclick="Load({$record_item.id})" data-toggle="modal" data-target="#update_record">编辑</button>
				</div>
			 <!--  <span class="h3 small pull-right">作者:{$record_item.author}</span> -->
			  <span class="h3 small">添加时间:{$record_item.create_time}</span>
			  </div>
			  <div class="panel-body">
			    {$record_item.content}
			    
				<div class="comment">
				<form method="post" action='{$Think.config.INDEX}/user_c_add' class="form-group col-lg-12">
			  	评论：<input type="text" name='content' class="form-control">
			  	<input type="hidden" name="record_id"  value="{$record_item.id}">
						<input type="submit" value="提交">
					{volist name='$record_item.comments' id='c_item'}
					<li>{$c_item.name}:{$c_item.content}</li>
						{volist name='c_item.comment_children' id='child_item'}
							<li style="padding-left:40px ;">{$child_item.name}回复{$c_item.name}:{$child_item.content}</li>
						{/volist}
					{/volist}
				</form>

			  	</div>
			  </div>
			</div>
			</li>
			{/volist}
		</ul>

	  </div>
	  <div role="tabpanel" class="tab-pane fade" id="add_record">
		<br>
	  	<br>
		<form class="form-group" action="{$Think.config.INDEX}/user_r_add" method="post">
			title:<input class="form-control" type="text" name="title"><br>
			content: <textarea class="form-control" name="content"  cols="30" rows="10"></textarea>
			<input class="form-control" type="submit" value="add">	
		</form>
	  </div>
	  <div role="tabpanel" class="tab-pane fade" id="friends_records">
  		<br>
	  	<br>
		{if condition="!empty($friendsRecordList)"}
		<ul class="list">
			{volist name='friendsRecordList' id='item'}
			<li>
			<div class="panel panel-default">
			  <div class="panel-heading">
			  <span class="h3">{$item.title}</span>
			  <span class="h3 small pull-right">作者:{$item.author}</span>
			  <span class="h3 small pull-right">添加时间:{$item.create_time}</span>
			  </div>
			  <div class="panel-body">
			    {$item.content}
			      <div class="comment">
					<form method="post" action='{$Think.config.INDEX}/user_c_add' class="form-group col-lg-12">
				  	评论：<input type="text" name='content' class="form-control">
				  	<input type="hidden" name="record_id"  value="{$item.id}">
							<input type="submit" value="提交">
						{volist name='$item.comments' id='c_item'}
						<li>{$c_item.name}:{$c_item.content}</li>
							{volist name='c_item.comment_children' id='child_item'}
								<li style="padding-left:40px ;">{$child_item.name}回复{$c_item.name}:{$child_item.content}</li>
							{/volist}
						{/volist}
					</form>
			  	</div>
			  </div>
			
			</div>
			</li>
			{/volist}
		</ul>
		{else/}
		<h1>获取好友记事列表失败，因为你还没有好友或好友并未发表说说。</h1>
		{/if}
	  </div>
	  <div role="tabpanel" class="tab-pane fade" id="friends_list">
		<br>
	  	<br>
		<ul class="list">
		{volist name='friendList' id='item' }
			<li>{$item.friend_name} 
			<a href="{$Think.config.INDEX}/user_f_delete?friend_id={$item.friend_id}">删除</a>
			</li>
		{/volist}
		</ul>
	  </div>
	  <div role="tabpanel" class="tab-pane fade" id="add_friend">
		<br>
	  	<br>
		<form class="form-group" action="{$Think.config.INDEX}/user_f_add" method="get">
			name:<input class="form-control" type="text" name="user_name"><br>
			<input class="form-control" type="submit" value="add">	
		</form>
	  </div>
	  <div role="tabpanel" class="tab-pane fade" id="logout">
	    <br>
	  	<br>
		<a href="{$Think.config.INDEX}/user_logout">注销</a>
	  </div>
	</div>
</div>
</content>

<div id="update_record" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">编辑记事</h4>
      </div>
      <div class="modal-body">
		<form action="{$Think.config.INDEX}/user_r_update" method="POST" role="form">
	    <legend></legend>
	
	    <div class="form-group">
	        <label for="">请修改原来的记事</label>
	        <input id="old_record" name="content" type="text" class="form-control"  placeholder="">
	        <input type="hidden" name="id" id="old_record_id" >
	        <input type="hidden" name="user_id" id="user_id" >
	    </div>
	    <button type="submit"  class="btn btn-primary">保存</button>
		</form>        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<footer>
	
</footer>	

<script>
	
	function Load(record_id)
	{
		console.log(record_id);

		$.ajax({
			url: '/index.php/index/record.Record/getSingleRecord',
			type: 'GET',
			//dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
			data: {id:record_id },

		})
		.done(function(data) {
			console.log("success");
			console.log(data);
			$('#old_record').val(data.content);
			$('#old_record_id').val(data.id);
			$('#user_id').val(data.user_id);
		})
		.fail(function() {
			console.log("error");
		})
		.always(function() {
			console.log("complete");
		});
	}
	function Control(){
		console.log('hello');
		flag=$(".control").css("visibility");
		if(flag=="hidden")
			$(".control").css("visibility","visible");
		else
			$(".control").css("visibility","hidden");
	}
</script>	
</body>
</html>	